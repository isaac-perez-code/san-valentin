<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eternal Amor - San Valent√≠n</title>
    <!-- Fonts and Libraries -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;700&family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        :root {
            --bg-primary: #fff5f7;
            --bg-secondary: #ffe4e8;
            --text-primary: #2d1b1b;
            --text-secondary: #664444;
            --accent-1: #ffb6c1;
            --accent-2: #ffd700;
            --accent-3: #e6c8c8;
            --gradient-1: linear-gradient(135deg, #ffb6c1, #ffd700);
            --gradient-2: linear-gradient(45deg, #ffe4e8, #fff5f7);
            --shadow: 0 10px 30px rgba(255, 182, 193, 0.3);
            --font-cursive: 'Dancing Script', cursive;
            --font-sans: 'Poppins', sans-serif;
        }

        .dark-mode {
            --bg-primary: #2d1b2d;
            --bg-secondary: #3d2a3d;
            --text-primary: #ffd700;
            --text-secondary: #e6c8e6;
            --accent-1: #9370db;
            --accent-2: #ffd700;
            --accent-3: #8b4513;
            --gradient-1: linear-gradient(135deg, #9370db, #ffd700);
            --gradient-2: linear-gradient(45deg, #3d2a3d, #2d1b2d);
            --shadow: 0 10px 30px rgba(147, 112, 219, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            transition: background-color 0.5s, color 0.3s;
        }

        body {
            font-family: var(--font-sans);
            background: var(--bg-primary);
            color: var(--text-primary);
            overflow-x: hidden;
            position: relative;
        }

        /* Particles Background */
        #particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            pointer-events: none;
        }

        /* Floating Hearts */
        .floating-heart {
            position: fixed;
            font-size: 20px;
            color: var(--accent-2);
            pointer-events: none;
            z-index: 9998;
            animation: floatUp 8s linear infinite;
            opacity: 0.6;
        }

        @keyframes floatUp {
            0% {
                transform: translateY(100vh) rotate(0deg);
                opacity: 0.6;
            }
            100% {
                transform: translateY(-100px) rotate(360deg);
                opacity: 0;
            }
        }

        /* Header and Navigation */
        .header {
            text-align: center;
            padding: 2rem;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            position: relative;
            z-index: 1000;
        }

        h1 {
            font-family: var(--font-cursive);
            font-size: 4rem;
            background: var(--gradient-1);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 1rem;
            animation: titleGlow 3s ease-in-out infinite;
        }

        @keyframes titleGlow {
            0%, 100% { filter: drop-shadow(0 0 10px var(--accent-2)); }
            50% { filter: drop-shadow(0 0 20px var(--accent-1)); }
        }

        .nav-buttons {
            display: flex;
            justify-content: center;
            gap: 1rem;
            flex-wrap: wrap;
            margin: 2rem 0;
        }

        .nav-btn {
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: 50px;
            background: var(--gradient-1);
            color: white;
            font-family: var(--font-sans);
            font-weight: 500;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            box-shadow: var(--shadow);
        }

        .nav-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 35px rgba(255, 182, 193, 0.4);
        }

        /* Main Container */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* Sections */
        .section {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Love Letter */
        .letter-container {
            perspective: 1000px;
            margin: 2rem auto;
            max-width: 600px;
        }

        .letter {
            background: var(--bg-secondary);
            padding: 2rem;
            border-radius: 20px;
            box-shadow: var(--shadow);
            transform-style: preserve-3d;
            transition: transform 0.8s;
            cursor: pointer;
            position: relative;
        }

        .letter.open {
            transform: rotateX(180deg);
        }

        .letter-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1rem;
            backface-visibility: hidden;
        }

        .letter.open .letter-content {
            display: none;
        }

        .letter-inside {
            display: none;
            transform: rotateX(180deg);
            backface-visibility: hidden;
        }

        .letter.open .letter-inside {
            display: block;
        }

        /* Gallery */
        .swiper {
            width: 100%;
            height: 800px;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: var(--shadow);
        }

        .swiper-slide {
            position: relative;
        }

        .swiper-slide img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .slide-caption {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 1rem;
            background: linear-gradient(transparent, rgba(0,0,0,0.7));
            color: white;
            font-family: var(--font-cursive);
            font-size: 1.2rem;
        }

        /* Counter */
        .counter-container {
            text-align: center;
            padding: 3rem;
            background: var(--bg-secondary);
            border-radius: 20px;
            box-shadow: var(--shadow);
        }

        .counter-number {
            font-size: 5rem;
            font-family: var(--font-cursive);
            background: var(--gradient-1);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin: 1rem 0;
        }

        .counter-label {
            font-size: 1.5rem;
            color: var(--text-secondary);
        }

        /* Music Player */
        .music-player {
            background: var(--bg-secondary);
            border-radius: 20px;
            padding: 2rem;
            box-shadow: var(--shadow);
            margin: 2rem 0;
        }

        .player-controls {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 2rem;
            margin: 2rem 0;
        }

        .control-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: none;
            background: var(--gradient-1);
            color: white;
            cursor: pointer;
            transition: transform 0.3s;
        }

        .control-btn:hover {
            transform: scale(1.1);
        }

        .playlist {
            display: grid;
            gap: 0.5rem;
            max-height: 200px;
            overflow-y: auto;
        }

        .playlist-item {
            padding: 0.8rem;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .playlist-item:hover {
            background: rgba(255,255,255,0.2);
        }

        .playlist-item.active {
            background: var(--gradient-1);
            color: white;
        }

        /* Timeline */
        .timeline {
            position: relative;
            padding: 2rem 0;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            width: 2px;
            height: 100%;
            background: var(--gradient-1);
        }

        .timeline-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 2rem 0;
            position: relative;
        }

        .timeline-content {
            width: 45%;
            padding: 1.5rem;
            background: var(--bg-secondary);
            border-radius: 20px;
            box-shadow: var(--shadow);
        }

        .timeline-item:nth-child(even) .timeline-content {
            margin-left: auto;
        }

        .timeline-date {
            font-family: var(--font-cursive);
            color: var(--accent-2);
            font-size: 1.2rem;
        }

        /* Poem Generator */
        .poem-container {
            text-align: center;
            padding: 3rem;
            background: var(--bg-secondary);
            border-radius: 20px;
            box-shadow: var(--shadow);
        }

        .poem-text {
            font-family: var(--font-cursive);
            font-size: 1.5rem;
            margin: 2rem 0;
            line-height: 2;
        }

        /* Mini Games */
        .game-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
            margin: 2rem 0;
        }

        .game-card {
            padding: 2rem;
            background: var(--bg-secondary);
            border-radius: 20px;
            box-shadow: var(--shadow);
            text-align: center;
            cursor: pointer;
            transition: transform 0.3s;
        }

        .game-card:hover {
            transform: translateY(-5px);
        }

        .game-icon {
            font-size: 3rem;
            color: var(--accent-2);
            margin-bottom: 1rem;
        }

        /* Puzzle Game */
        .puzzle-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 5px;
            max-width: 300px;
            margin: 2rem auto;
        }

        .puzzle-piece {
            aspect-ratio: 1;
            background-size: 300% 300%;
            cursor: pointer;
            transition: opacity 0.3s;
            border-radius: 5px;
        }

        .puzzle-piece.empty {
            opacity: 0;
            cursor: default;
        }

        /* WhatsApp Buttons */
        .whatsapp-buttons {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin: 2rem 0;
            flex-wrap: wrap;
        }

        .whatsapp-btn {
            padding: 1rem 2rem;
            border: none;
            border-radius: 50px;
            background: #25D366;
            color: white;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            transition: transform 0.3s;
        }

        .whatsapp-btn:hover {
            transform: scale(1.05);
        }

        /* Surprise Button */
        .surprise-btn {
            padding: 1.5rem 3rem;
            font-size: 1.5rem;
            border: none;
            border-radius: 50px;
            background: var(--gradient-1);
            color: white;
            cursor: pointer;
            margin: 2rem auto;
            display: block;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        /* Confetti */
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background: var(--accent-2);
            position: absolute;
            animation: confettiFall 3s linear forwards;
            z-index: 9999;
        }

        @keyframes confettiFall {
            0% {
                transform: translateY(-100vh) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }

        /* Dark Mode Toggle */
        .dark-mode-toggle {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--gradient-1);
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            z-index: 1000;
            box-shadow: var(--shadow);
            transition: transform 0.3s;
        }

        .dark-mode-toggle:hover {
            transform: rotate(360deg);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            h1 {
                font-size: 3rem;
            }

            .timeline::before {
                left: 20px;
            }

            .timeline-content {
                width: calc(100% - 50px);
                margin-left: 50px !important;
            }

            .counter-number {
                font-size: 3rem;
            }

            .swiper {
                height: 300px;
            }
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 10px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-primary);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--gradient-1);
            border-radius: 5px;
        }

        /* Loading Animation */
        .loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--bg-primary);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            transition: opacity 0.5s;
        }

        .loading.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .heart-loading {
            width: 100px;
            height: 100px;
            background: var(--gradient-1);
            animation: heartBeat 1s infinite;
            clip-path: path("M50,88 L20,58 C10,48 10,32 20,22 C30,12 45,12 55,22 L50,28 L45,22 C35,12 20,12 10,22 C0,32 0,48 10,58 L50,88 Z");
        }

        @keyframes heartBeat {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
    </style>
</head>
<body>
    <!-- Loading Animation -->
    <div class="loading" id="loading">
        <div class="heart-loading"></div>
    </div>

    <!-- Floating Hearts -->
    <div id="floating-hearts"></div>

    <!-- Particles Canvas -->
    <canvas id="particles"></canvas>

    <!-- Header -->
    <header class="header">
        <h1>Eternal Amor</h1>
        <div class="nav-buttons">
            <button class="nav-btn" onclick="showSection('letter')">üíå Carta</button>
            <button class="nav-btn" onclick="showSection('gallery')">üì∏ Galer√≠a</button>
            <button class="nav-btn" onclick="showSection('counter')">‚è∞ Contador</button>
            <button class="nav-btn" onclick="showSection('music')">üéµ M√∫sica</button>
            <button class="nav-btn" onclick="showSection('poems')">üìù Poemas</button>
            <button class="nav-btn" onclick="showSection('games')">üéÆ Juegos</button>
        </div>
    </header>

    <main class="container">
        <!-- Love Letter Section -->
        <section id="letter" class="section active">
            <div class="letter-container">
                <div class="letter" onclick="toggleLetter()">
                    <div class="letter-content">
                        <i class="fas fa-heart" style="font-size: 3rem; color: var(--accent-2);"></i>
                        <h2>Haz clic para abrir</h2>
                        <p>Una carta especial para ti</p>
                    </div>
                    <div class="letter-inside">
                        <h2>Mi Amor,</h2>
                        <p>Cada d√≠a a tu lado es un regalo. Tu sonrisa ilumina mi mundo y tu amor hace que mi coraz√≥n lata m√°s fuerte. En este San Valent√≠n, quiero recordarte lo especial que eres para m√≠.</p>
                        <p>Eres la raz√≥n por la que creo en el amor eterno.</p>
                        <p>Con todo mi coraz√≥n,</p>
                        <p><strong>Tu amor eterno</strong></p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Gallery Section -->
        <section id="gallery" class="section">
            <div class="swiper">
                <div class="swiper-wrapper" id="gallerySwiper"></div>
                <div class="swiper-pagination"></div>
                <div class="swiper-button-prev"></div>
                <div class="swiper-button-next"></div>
            </div>
        </section>

        <!-- Counter Section -->
        <section id="counter" class="section">
            <div class="counter-container">
                <h2>Juntos por</h2>
                <div class="counter-number" id="daysCounter">0</div>
                <div class="counter-label">d√≠as de amor infinito</div>
                <input type="date" id="startDate" class="date-input" style="margin-top: 2rem; padding: 0.5rem; border-radius: 10px; border: 1px solid var(--accent-1);">
                <button class="nav-btn" onclick="updateStartDate()" style="margin-left: 1rem;">Actualizar</button>
            </div>
        </section>

        <!-- Music Section -->
        <!-- Music Section -->
<section id="music" class="section">
    <div class="music-player">
        <h2>Nuestra Playlist</h2>
        
        <!-- Mensaje de estado -->
        <div id="audioStatus" style="text-align: center; padding: 1rem; color: var(--accent-2);">
            Cargando reproductor...
        </div>
        
        <div class="player-controls">
            <button class="control-btn" onclick="prevTrack()"><i class="fas fa-backward"></i></button>
            <button class="control-btn" onclick="playPause()"><i class="fas fa-play" id="playIcon"></i></button>
            <button class="control-btn" onclick="nextTrack()"><i class="fas fa-forward"></i></button>
        </div>
        
        <!-- Informaci√≥n de la canci√≥n actual -->
        <div style="text-align: center; margin: 1rem;" id="currentTrackInfo">
            No hay canci√≥n seleccionada
        </div>
        
        <div class="playlist" id="playlist"></div>
    </div>
</section>

        <!-- Timeline Section -->
        <section id="timeline" class="section">
            <div class="timeline" id="timelineContainer"></div>
        </section>

        <!-- Poems Section -->
        <section id="poems" class="section">
            <div class="poem-container">
                <h2>Poema del D√≠a</h2>
                <div class="poem-text" id="dailyPoem"></div>
                <button class="nav-btn" onclick="generateNewPoem()">Generar Nuevo Poema</button>
            </div>
        </section>

        <!-- Games Section -->
        <section id="games" class="section">
            <div class="game-container">
                <div class="game-card" onclick="startTrivia()">
                    <div class="game-icon"><i class="fas fa-question-circle"></i></div>
                    <h3>Trivia Rom√°ntica</h3>
                    <p>Pon a prueba tu conocimiento sobre nosotros</p>
                </div>
                <div class="game-card" onclick="startPuzzle()">
                    <div class="game-icon"><i class="fas fa-puzzle-piece"></i></div>
                    <h3>Rompecabezas</h3>
                    <p>Arma nuestra foto especial</p>
                </div>
            </div>
            <div id="gameArea"></div>
        </section>

        <!-- WhatsApp Buttons -->
        <div class="whatsapp-buttons">
            <a href="https://wa.me/51923024300?text=Te%20amo%20mi%20vida%20‚ù§Ô∏è" class="whatsapp-btn" target="_blank">
                <i class="fab fa-whatsapp"></i> Enviar mensaje amor Caro
            </a>
            <a href="https://wa.me/51983569753?text=Hola%20amor%2C%20te%20extra√±o%20‚ù§Ô∏è" class="whatsapp-btn" target="_blank">
                <i class="fab fa-whatsapp"></i> Enviarme mensaje amor Isaac
            </a>
        </div>

        <!-- Surprise Button -->
        <button class="surprise-btn" onclick="showSurprise()">
            <i class="fas fa-gift"></i> Sorpresa
        </button>
    </main>

    <!-- Dark Mode Toggle -->
    <button class="dark-mode-toggle" onclick="toggleDarkMode()">
        <i class="fas fa-moon"></i>
    </button>

    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    <script>
        // Global Variables
        let swiper = null;
        let currentTrack = 0;
        let isPlaying = false;
        let audio = new Audio();
        let darkMode = localStorage.getItem('darkMode') === 'true';
        let startDate = localStorage.getItem('startDate') || '2024-01-01';
        
        // Sample Data
        const playlist = [
            { title: "Amor de Febrero", url:"audios/amor-febrero.mp3" },
            { title: "Birdie", url: "audios/BIRDIE.mp3" },
            { title: "Junto a ti envejecer", url: "audios/envejecer.mp3" },
            { title: "Ti amo", url: "audios/te-odio-te-amo.mp3" },
            { title: "Volvi a nacer", url: "audios/volvi-nacer.mp3" }
        ];

        const poems = [
            "Eres la luz que ilumina mis d√≠as,\nla raz√≥n de mis sonrisas y alegr√≠as.\nCada momento a tu lado es especial,\nun amor que se vuelve eternal.",
            "Tus ojos son dos estrellas\nque gu√≠an mi caminar,\ntu sonrisa es la m√°s bella,\nla que me hace so√±ar.",
            "En el jard√≠n de mi vida,\neres la flor m√°s bonita,\nla que con solo una mirada,\nmi coraz√≥n revitaliza.",
            "El tiempo se detiene cuando te veo,\ncada latido es un deseo,\nde tenerte siempre aqu√≠,\ny hacerte muy feliz.",
            "Eres el sue√±o que no quiero despertar,\nla raz√≥n de mi respirar,\nel amor que siempre so√±√©,\nla persona que eleg√≠ para amar√©."
        ];

        

        const galleryImages = [
            { url: "images/primera-foto.png", caption: "Nuestra primera foto juntos" },
            { url: "images/1.jpeg" },
            { url: "images/2.jpeg" },
            { url: "images/3.jpeg" },
            { url: "images/4 (2).jpeg" },
            { url: "images/5.jpeg" },
            { url: "images/6.jpeg" },
            { url: "images/7.jpeg" },
            { url: "images/8.jpeg" },
            { url: "images/9.jpeg" },
            { url: "images/10.jpeg" },
            { url: "images/11.jpeg" },
        ];

        // Initialize Particles
        function initParticles() {
            const canvas = document.getElementById('particles');
            const ctx = canvas.getContext('2d');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;

            const particles = [];
            for (let i = 0; i < 50; i++) {
                particles.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height,
                    radius: Math.random() * 3 + 1,
                    speedX: Math.random() * 2 - 1,
                    speedY: Math.random() * 2 - 1,
                    color: `rgba(255, 182, 193, ${Math.random() * 0.5 + 0.2})`
                });
            }

            function animate() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                particles.forEach(p => {
                    p.x += p.speedX;
                    p.y += p.speedY;
                    
                    if (p.x < 0 || p.x > canvas.width) p.speedX *= -1;
                    if (p.y < 0 || p.y > canvas.height) p.speedY *= -1;
                    
                    ctx.beginPath();
                    ctx.arc(p.x, p.y, p.radius, 0, Math.PI * 2);
                    ctx.fillStyle = p.color;
                    ctx.fill();
                });
                
                requestAnimationFrame(animate);
            }
            
            animate();
        }

        // Floating Hearts
        function createFloatingHeart() {
            const heart = document.createElement('div');
            heart.className = 'floating-heart';
            heart.innerHTML = '‚ù§Ô∏è';
            heart.style.left = Math.random() * 100 + 'vw';
            heart.style.animationDuration = Math.random() * 5 + 5 + 's';
            heart.style.fontSize = Math.random() * 20 + 10 + 'px';
            document.getElementById('floating-hearts').appendChild(heart);
            
            setTimeout(() => {
                heart.remove();
            }, 8000);
        }

        setInterval(createFloatingHeart, 1000);

        // Initialize Swiper Gallery
        function initGallery() {
            const swiperWrapper = document.getElementById('gallerySwiper');
            swiperWrapper.innerHTML = galleryImages.map(img => `
                <div class="swiper-slide">
                    <img src="${img.url}" alt="${img.caption}">
                    <div class="slide-caption">${img.caption}</div>
                </div>
            `).join('');

            if (swiper) swiper.destroy();
            
            swiper = new Swiper('.swiper', {
                loop: true,
                pagination: { el: '.swiper-pagination', clickable: true },
                navigation: { nextEl: '.swiper-button-next', prevEl: '.swiper-button-prev' },
                effect: 'coverflow',
                coverflowEffect: { rotate: 50, stretch: 0, depth: 100, modifier: 1, slideShadows: true }
            });
        }

        // Initialize Timeline
        function initTimeline() {
            const timeline = document.getElementById('timelineContainer');
            timeline.innerHTML = timelineEvents.map((event, index) => `
                <div class="timeline-item">
                    <div class="timeline-content">
                        <div class="timeline-date">${new Date(event.date).toLocaleDateString('es-ES', { year: 'numeric', month: 'long', day: 'numeric' })}</div>
                        <h3>${event.title}</h3>
                        <p>${event.description}</p>
                    </div>
                </div>
            `).join('');
        }

        // Initialize Music Player
    // Inicializar reproductor con verificaci√≥n
function initMusicPlayer() {
    const playlistElement = document.getElementById('playlist');
    const statusElement = document.getElementById('audioStatus');
    
    // Verificar que el archivo existe
    fetch(playlist[0].url, { method: 'HEAD' })
        .then(response => {
            if (response.ok) {
                statusElement.innerHTML = '‚úÖ Archivo de audio encontrado';
                statusElement.style.color = 'green';
            } else {
                statusElement.innerHTML = '‚ùå No se encuentra el archivo. Verifica la ruta: ' + playlist[0].url;
                statusElement.style.color = 'red';
            }
        })
        .catch(error => {
            statusElement.innerHTML = '‚ùå Error al cargar: ' + error.message;
            statusElement.style.color = 'red';
        });
    
    // Mostrar playlist
    playlistElement.innerHTML = playlist.map((track, index) => `
        <div class="playlist-item ${index === currentTrack ? 'active' : ''}" onclick="playTrack(${index})">
            ${track.title}
        </div>
    `).join('');
    
    // Actualizar informaci√≥n de la canci√≥n
    document.getElementById('currentTrackInfo').innerHTML = 
        `<strong>${playlist[0].title}</strong><br><small>Ruta: ${playlist[0].url}</small>`;
}

// Funci√≥n mejorada para reproducir
function playTrack(index) {
    currentTrack = index;
    const track = playlist[index];
    
    // Actualizar UI
    document.getElementById('currentTrackInfo').innerHTML = 
        `<strong>Reproduciendo: ${track.title}</strong><br><small>${track.url}</small>`;
    
    // Intentar reproducir
    audio.src = track.url;
    audio.play()
        .then(() => {
            isPlaying = true;
            document.getElementById('playIcon').className = 'fas fa-pause';
            document.getElementById('audioStatus').innerHTML = '‚úÖ Reproduciendo';
        })
        .catch(error => {
            document.getElementById('audioStatus').innerHTML = '‚ùå Error: ' + error.message;
            console.error('Error al reproducir:', error);
        });
    
    initMusicPlayer();
}

        function playPause() {
            if (isPlaying) {
                audio.pause();
                document.getElementById('playIcon').className = 'fas fa-play';
            } else {
                audio.play();
                document.getElementById('playIcon').className = 'fas fa-pause';
            }
            isPlaying = !isPlaying;
        }

        function prevTrack() {
            currentTrack = (currentTrack - 1 + playlist.length) % playlist.length;
            playTrack(currentTrack);
        }

        function nextTrack() {
            currentTrack = (currentTrack + 1) % playlist.length;
            playTrack(currentTrack);
        }

        // Counter Functions
        function updateCounter() {
            const start = new Date(startDate);
            const today = new Date();
            const diffTime = Math.abs(today - start);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            document.getElementById('daysCounter').textContent = diffDays;
        }

        function updateStartDate() {
            const newDate = document.getElementById('startDate').value;
            if (newDate) {
                startDate = newDate;
                localStorage.setItem('startDate', startDate);
                updateCounter();
            }
        }

        // Poem Functions
        function getDailyPoem() {
            const today = new Date().toDateString();
            const poemIndex = Math.abs(today.split('').reduce((a, b) => a + b.charCodeAt(0), 0)) % poems.length;
            document.getElementById('dailyPoem').textContent = poems[poemIndex];
        }

        function generateNewPoem() {
            const randomIndex = Math.floor(Math.random() * poems.length);
            document.getElementById('dailyPoem').textContent = poems[randomIndex];
        }

        // Game Functions
        function startTrivia() {
            const gameArea = document.getElementById('gameArea');
            gameArea.innerHTML = `
                <div style="text-align: center; padding: 2rem; background: var(--bg-secondary); border-radius: 20px;">
                    <h3>¬øCu√°ndo fue nuestro beso?</h3>
                    <div style="display: grid; gap: 1rem; margin-top: 2rem;">
                        <button class="nav-btn" onclick="checkTrivia('wrong')">2020</button>
                        <button class="nav-btn" onclick="checkTrivia('correct')">2021</button>
                        <button class="nav-btn" onclick="checkTrivia('wrong')">2022</button>
                    </div>
                </div>
            `;
        }

        function checkTrivia(answer) {
            const gameArea = document.getElementById('gameArea');
            if (answer === 'correct') {
                gameArea.innerHTML = '<div style="text-align: center; padding: 2rem; background: var(--bg-secondary); border-radius: 20px;"><h3>‚úÖ ¬°Correcto! Sabes mucho de nosotros</h3></div>';
            } else {
                gameArea.innerHTML = '<div style="text-align: center; padding: 2rem; background: var(--bg-secondary); border-radius: 20px;"><h3>‚ùå Intenta de nuevo, el amor todo lo puede</h3></div>';
            }
        }

        // Variables globales para el puzzle
let puzzlePieces = [];
let emptyIndex = 8;
let puzzleSolved = false;

// Funci√≥n mejorada para iniciar el rompecabezas
function startPuzzle() {
    const gameArea = document.getElementById('gameArea');
    puzzlePieces = [0, 1, 2, 3, 4, 5, 6, 7, 8];
    emptyIndex = 8;
    puzzleSolved = false;
    
    // Mezclar piezas (versi√≥n mejorada)
    for (let i = 0; i < 100; i++) {
        const possibleMoves = getPossibleMoves(emptyIndex);
        const randomMove = possibleMoves[Math.floor(Math.random() * possibleMoves.length)];
        movePiece(randomMove, true); // true = solo l√≥gica, sin UI
    }
    
    gameArea.innerHTML = `
        <div style="text-align: center; padding: 2rem; background: var(--bg-secondary); border-radius: 20px;">
            <h3 style="font-family: var(--font-cursive); font-size: 2rem; margin-bottom: 1rem;">üß© Rompecabezas de Amor</h3>
            <p style="margin-bottom: 2rem;">Arma la foto para revelar nuestro momento especial</p>
            <div class="puzzle-container" id="puzzleGrid"></div>
            <div style="margin-top: 2rem;">
                <button class="nav-btn" onclick="shufflePuzzle()">üîÑ Mezclar piezas</button>
                <button class="nav-btn" onclick="solvePuzzle()">‚ú® Resolver autom√°gicamente</button>
            </div>
            <div id="puzzleMessage" style="margin-top: 2rem; font-family: var(--font-cursive); font-size: 1.5rem;"></div>
        </div>
    `;
    
    renderPuzzle();
}


function getPossibleMoves(emptyPos) {
    const moves = [];
    const row = Math.floor(emptyPos / 3);
    const col = emptyPos % 3;
    
    if (row > 0) moves.push(emptyPos - 3); // arriba
    if (row < 2) moves.push(emptyPos + 3); // abajo
    if (col > 0) moves.push(emptyPos - 1); // izquierda
    if (col < 2) moves.push(emptyPos + 1); // derecha
    
    return moves;
}

function movePiece(index, skipRender = false) {
    if (puzzleSolved) return;
    
    const possibleMoves = getPossibleMoves(emptyIndex);
    
    if (possibleMoves.includes(index)) {
        // Intercambiar piezas
        [puzzlePieces[emptyIndex], puzzlePieces[index]] = [puzzlePieces[index], puzzlePieces[emptyIndex]];
        emptyIndex = index;
        
        if (!skipRender) {
            renderPuzzle();
            checkPuzzleSolved();
        }
    }
}

function renderPuzzle() {
    const grid = document.getElementById('puzzleGrid');
    if (!grid) return;
    
    grid.innerHTML = '';
    
    puzzlePieces.forEach((piece, index) => {
        const pieceDiv = document.createElement('div');
        pieceDiv.className = 'puzzle-piece' + (piece === 8 ? ' empty' : '');
        
        if (piece !== 8) {
            // Usar una imagen local si existe, si no usar una de respaldo
            const imageUrl = document.querySelector('.swiper-slide ')?.src || 
                            'images/rompe-cabeza.jpeg';
            
            pieceDiv.style.backgroundImage = `url('${imageUrl}')`;
            pieceDiv.style.backgroundSize = '300% 300%';
            pieceDiv.style.backgroundPosition = `${(piece % 3) * 33.33}% ${Math.floor(piece / 3) * 33.33}%`;
        }
        
        pieceDiv.onclick = () => movePiece(index);
        grid.appendChild(pieceDiv);
    });
}

function shufflePuzzle() {
    for (let i = 0; i < 50; i++) {
        const possibleMoves = getPossibleMoves(emptyIndex);
        const randomMove = possibleMoves[Math.floor(Math.random() * possibleMoves.length)];
        movePiece(randomMove, true);
    }
    puzzleSolved = false;
    renderPuzzle();
    document.getElementById('puzzleMessage').innerHTML = '';
}

function solvePuzzle() {
    puzzlePieces = [0, 1, 2, 3, 4, 5, 6, 7, 8];
    emptyIndex = 8;
    puzzleSolved = true;
    renderPuzzle();
    document.getElementById('puzzleMessage').innerHTML = 'üíù ¬°Resuelto! Eres incre√≠ble üíù';
    createMiniConfetti();
}

function checkPuzzleSolved() {
    const solved = puzzlePieces.every((piece, index) => piece === index);
    if (solved) {
        puzzleSolved = true;
        document.getElementById('puzzleMessage').innerHTML = 'üéâ ¬°Felicidades! Completaste el rompecabezas. Nuestro amor es perfecto üéâ';
        createMiniConfetti();
    }
}

function createMiniConfetti() {
    for (let i = 0; i < 30; i++) {
        setTimeout(() => {
            const confetti = document.createElement('div');
            confetti.className = 'confetti';
            confetti.style.left = Math.random() * 100 + 'vw';
            confetti.style.background = `hsl(${Math.random() * 60 + 300}, 100%, 50%)`;
            document.body.appendChild(confetti);
            setTimeout(() => confetti.remove(), 3000);
        }, i * 50);
    }
}

        // SURPRISE FUNCTION - VERSI√ìN CON VIDEO
        let surprises = [
            {
                type: "video",  // ‚Üê NUEVO TIPO DE VIDEO
                content: "images/dedicatoria.mp4",
                emoji: "üé•"
            },
            {
                type: "mensaje",
                content: "Te amo m√°s que ayer, pero menos que ma√±ana üíï",
                emoji: "üíå"
            },
            {
                type: "mensaje",
                content: "Eres la persona que siempre so√±√© tener a mi lado ‚ú®",
                emoji: "üíù"
            },
            {
                type: "mensaje",
                content: "Cada d√≠a me enamoro m√°s de ti üåπ",
                emoji: "üíë"
            },
            {
                type: "mensaje",
                content: "Tu sonrisa es la raz√≥n de mi felicidad üòä",
                emoji: "‚òÄÔ∏è"
            },
            {
                type: "mensaje",
                content: "Eres mi presente, mi futuro y mi eternidad üåü",
                emoji: "üí´"
            },
            {
                type: "imagen",
                content: "images/primera-foto.png",
                emoji: "üñºÔ∏è"
            }
        ];

        function showSurprise() {
            // Elegir una sorpresa aleatoria
            const random = surprises[Math.floor(Math.random() * surprises.length)];
            
            // Crear confeti
            for (let i = 0; i < 50; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * 100 + 'vw';
                    confetti.style.background = `hsl(${Math.random() * 60 + 300}, 100%, 50%)`;
                    document.body.appendChild(confetti);
                    setTimeout(() => confetti.remove(), 3000);
                }, i * 30);
            }
            
            // Crear el mensaje sorpresa
            let content = '';
            
            if (random.type === 'video') {  // ‚Üê NUEVA SECCI√ìN PARA VIDEO
                content = `
                    <div style="font-size: 3rem; margin-bottom: 1rem;">${random.emoji} Video Mensaje</div>
                    <video controls style="max-width: 100%; max-height: 400px; border-radius: 20px; box-shadow: var(--shadow);">
                        <source src="${random.content}" type="video/mp4">
                        Tu navegador no soporta el elemento de video.
                    </video>
                    <p style="margin-top: 1rem;">Un mensaje especial para ti üíï</p>
                `;
            } 
            else if (random.type === 'imagen') {
                content = `
                    <div style="font-size: 3rem; margin-bottom: 1rem;">${random.emoji}</div>
                    <img src="${random.content}" style="max-width: 100%; max-height: 300px; border-radius: 20px; box-shadow: var(--shadow);" 
                         onerror="this.src='https://images.pexels.com/photos/2253870/pexels-photo-2253870.jpeg?auto=compress&cs=tinysrgb&w=400'">
                    <p style="margin-top: 1rem;">Un recuerdo especial ‚ù§Ô∏è</p>
                `;
            }
            else if (random.type === 'mensaje') {
                content = `
                    <div style="font-size: 4rem; margin-bottom: 1rem;">${random.emoji}</div>
                    <p style="font-family: var(--font-cursive); font-size: 2rem; color: var(--text-primary);">${random.content}</p>
                    <p style="margin-top: 2rem; font-size: 1.2rem;">‚ù§Ô∏è Para ti, mi amor ‚ù§Ô∏è</p>
                `;
            }
            
            // Crear el contenedor
            const surpriseDiv = document.createElement('div');
            surpriseDiv.innerHTML = `
                <div style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); 
                            background: white; padding: 2rem; border-radius: 30px; z-index: 10000; 
                            text-align: center; box-shadow: 0 20px 50px rgba(255,105,180,0.3);
                            max-width: 90%; max-height: 90%; overflow-y: auto;">
                    <button onclick="this.parentElement.parentElement.remove()" 
                            style="position: absolute; top: 10px; right: 10px; background: none; 
                                   border: none; font-size: 1.5rem; cursor: pointer; color: #999;">
                        ‚úñÔ∏è
                    </button>
                    ${content}
                </div>
            `;
            document.body.appendChild(surpriseDiv);
        }
        // Letter Function
        function toggleLetter() {
            document.querySelector('.letter').classList.toggle('open');
        }

        // Section Navigation
        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById(sectionId).classList.add('active');
        }

        // Dark Mode Toggle
        function toggleDarkMode() {
            darkMode = !darkMode;
            localStorage.setItem('darkMode', darkMode);
            if (darkMode) {
                document.body.classList.add('dark-mode');
                document.querySelector('.dark-mode-toggle i').className = 'fas fa-sun';
            } else {
                document.body.classList.remove('dark-mode');
                document.querySelector('.dark-mode-toggle i').className = 'fas fa-moon';
            }
        }

        // Audio Visualization
        audio.addEventListener('play', () => {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const source = audioContext.createMediaElementSource(audio);
            const analyser = audioContext.createAnalyser();
            source.connect(analyser);
            analyser.connect(audioContext.destination);
            
            analyser.fftSize = 256;
            const bufferLength = analyser.frequencyBinCount;
            const dataArray = new Uint8Array(bufferLength);
            
            function visualize() {
                requestAnimationFrame(visualize);
                analyser.getByteFrequencyData(dataArray);
                
                // Update particles based on music
                const average = dataArray.reduce((a, b) => a + b) / bufferLength;
                document.body.style.setProperty('--music-intensity', average / 256);
            }
            
            visualize();
        });

        // Initialize everything
        window.onload = () => {
            document.getElementById('loading').classList.add('hidden');
            
            initParticles();
            initGallery();
            initTimeline();
            initMusicPlayer();
            
            document.getElementById('startDate').value = startDate;
            updateCounter();
            setInterval(updateCounter, 86400000); // Update daily
            
            getDailyPoem();
            
            if (darkMode) {
                document.body.classList.add('dark-mode');
                document.querySelector('.dark-mode-toggle i').className = 'fas fa-sun';
            }
        };

        // Resize handler
        window.addEventListener('resize', () => {
            if (swiper) swiper.update();
        });
    </script>
</body>
</html>